---
title: "External Navigation Control"
icon: "compass"
---

## Overview

The `JoyDocNavigator` class enables programmatic navigation within JoyDoc forms. This allows you to build custom navigation experiences, implement validation-driven navigation, or guide users through form sections programmatically.

**Common Use Cases:**
- Jumping to invalid fields after form validation
- Building custom navigation UIs (table of contents, step wizards)
- Programmatically guiding users through form sections
- Implementing "Go to field" functionality

## Basic Setup

Create a navigator instance and pass it to the JoyDoc component:

```jsx
import React, { useMemo } from 'react';
import { JoyDoc, JoyDocNavigator } from '@joyfill/components';

function MyForm({ doc }) {
  // Create navigator instance once and persist across re-renders
  const navigator = useMemo(() => new JoyDocNavigator(), []);

  return (
    <JoyDoc
      doc={doc}
      mode="fill"
      navigator={navigator}
    />
  );
}
```

<Warning>
Always use `useMemo` or `useState` to create the navigator instance. This ensures the same instance persists across re-renders, maintaining the connection to JoyDoc.
</Warning>

## Navigation Methods

### goto(path)

Navigate to a page or field position within the form.

```jsx
// Navigate to a page (scrolls to top)
const result = await navigator.goto("pageId");

// Navigate to a specific field on a page
const result = await navigator.goto("pageId/fieldPositionId");
```

**Parameters:**

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `path` | `string` | Yes | Navigation path in format `"pageId"` or `"pageId/fieldPositionId"` |

**Returns:** `Promise<{ status: 'success' | 'failure' }>`

### isConnected()

Check if the navigator is connected to a JoyDoc instance.

```jsx
if (navigator.isConnected()) {
  await navigator.goto("pageId");
} else {
  console.warn('Navigator not connected');
}
```

**Returns:** `boolean`

## Path Formats

| Format | Description | Example |
|--------|-------------|---------|
| `"pageId"` | Navigate to page, scroll to top | `"507f1f77bcf86cd799439011"` |
| `"pageId/fieldPositionId"` | Navigate to page and scroll to field | `"507f1f77bcf86cd799439011/60d5ec9af682fbd12a892c4a"` |

## Navigation Rules

The navigator follows these rules when processing navigation requests:

| Scenario | Behavior | Return Status |
|----------|----------|---------------|
| Page doesn't exist | No navigation occurs | `failure` |
| Page is hidden (static or conditional) | No navigation occurs | `failure` |
| Page is visible | Navigates to page top | `success` |
| Page visible, field doesn't exist | Navigates to page top | `failure` |
| Page visible, field is hidden | Navigates to page top | `failure` |
| Page visible, field exists and visible | Navigates and scrolls to field | `success` |


## Complete Example

```jsx
import React, { useState, useMemo } from 'react';
import { JoyDoc, JoyDocNavigator } from '@joyfill/components';

function FormWithNavigation({ initialDoc }) {
  const [doc, setDoc] = useState(initialDoc);
  const navigator = useMemo(() => new JoyDocNavigator(), []);

  // Get pages for navigation UI
  const pages = doc?.files?.[0]?.pages || [];

  const handleNavigateToPage = async (pageId) => {
    const result = await navigator.goto(pageId);
    
    if (result.status === 'success') {
      console.log('Navigation successful');
    } else {
      console.log('Navigation failed - page may not exist or is hidden');
    }
  };

  const handleNavigateToField = async (pageId, fieldPositionId) => {
    const path = `${pageId}/${fieldPositionId}`;
    const result = await navigator.goto(path);
    
    if (result.status === 'success') {
      console.log('Navigated and scrolled to field');
    } else {
      console.log('Navigation failed');
    }
  };

  return (
    <div style={{ display: 'flex' }}>
      {/* Navigation Sidebar */}
      <nav style={{ width: 250, padding: 16 }}>
        <h3>Pages</h3>
        {pages.map(page => (
          <button
            key={page._id}
            onClick={() => handleNavigateToPage(page._id)}
            style={{ display: 'block', marginBottom: 8 }}
          >
            {page.name || 'Unnamed Page'}
          </button>
        ))}
      </nav>

      {/* JoyDoc Form */}
      <div style={{ flex: 1 }}>
        <JoyDoc
          doc={doc}
          mode="fill"
          navigator={navigator}
          onChange={(changelogs, updatedDoc) => setDoc(updatedDoc)}
        />
      </div>
    </div>
  );
}
```

## Use Case: Validation Navigation

Jump to the first invalid field after form validation:

```jsx
import { validator } from '@joyfill/components';

const handleValidateAndNavigate = async () => {
  const result = validator(doc);
  
  if (result.status !== 'valid') {
    // Find the first invalid field
    const firstInvalid = result.fieldValidations.find(v => !v.valid);
    
    if (firstInvalid) {
      // Navigate to the invalid field
      await navigator.goto(`${firstInvalid.pageId}/${firstInvalid.fieldPositionId}`);
    }
  }
};
```

## Use Case: Step-by-Step Wizard

Guide users through form pages sequentially:

```jsx
const [currentPageIndex, setCurrentPageIndex] = useState(0);
const pages = doc?.files?.[0]?.pages || [];

const handleNext = async () => {
  if (currentPageIndex < pages.length - 1) {
    const nextPage = pages[currentPageIndex + 1];
    const result = await navigator.goto(nextPage._id);
    
    if (result.status === 'success') {
      setCurrentPageIndex(currentPageIndex + 1);
    }
  }
};

const handlePrevious = async () => {
  if (currentPageIndex > 0) {
    const prevPage = pages[currentPageIndex - 1];
    const result = await navigator.goto(prevPage._id);
    
    if (result.status === 'success') {
      setCurrentPageIndex(currentPageIndex - 1);
    }
  }
};
```

## Use Case: Table of Contents

Build a table of contents that jumps to specific sections:

```jsx
const TableOfContents = ({ doc, navigator }) => {
  const pages = doc?.files?.[0]?.pages || [];

  return (
    <nav>
      <h2>Table of Contents</h2>
      <ul>
        {pages.map(page => (
          <li key={page._id}>
            <a 
              href="#"
              onClick={(e) => {
                e.preventDefault();
                navigator.goto(page._id);
              }}
            >
              {page.name}
            </a>
          </li>
        ))}
      </ul>
    </nav>
  );
};
```

## Error Handling

The navigator handles errors gracefully by returning failure status instead of throwing exceptions:

```jsx
const result = await navigator.goto("nonexistent-page-id");

if (result.status === 'failure') {
  // Handle gracefully - could be:
  // - Page doesn't exist
  // - Page is hidden by conditional logic
  // - Field position doesn't exist or is hidden
  // - Navigator not connected to JoyDoc
  console.log('Navigation could not be completed');
}
```

If the navigator is not connected to a JoyDoc instance, `goto()` will:
1. Log a warning to the console
2. Return `{ status: 'failure' }`

## Best Practices

<AccordionGroup>
  <Accordion title="Always use useMemo or useState">
    Create the navigator instance with `useMemo` or `useState` to maintain the connection across re-renders.
    
    ```jsx
    // Good
    const navigator = useMemo(() => new JoyDocNavigator(), []);
    
    // Also good
    const [navigator] = useState(() => new JoyDocNavigator());
    
    // Bad - creates new instance on every render
    const navigator = new JoyDocNavigator();
    ```
  </Accordion>
  
  <Accordion title="Check connection status for critical operations">
    Use `isConnected()` before navigation in cases where timing matters.
    
    ```jsx
    if (navigator.isConnected()) {
      await navigator.goto(pageId);
    }
    ```
  </Accordion>
  
  <Accordion title="Handle failure gracefully">
    The `goto()` method returns failure status for hidden or non-existent targets rather than throwing errors.
  </Accordion>
  
  <Accordion title="Consider conditional logic">
    Pages or fields hidden by conditional logic will return failure status when targeted. Update your navigation UI accordingly.
  </Accordion>
</AccordionGroup>

## API Reference

### JoyDocNavigator Class

| Method | Parameters | Returns | Description |
|--------|------------|---------|-------------|
| `goto(path)` | `path: string` | `Promise<{status: 'success' \| 'failure'}>` | Navigate to a page or field |
| `isConnected()` | none | `boolean` | Check if connected to JoyDoc |

### JoyDoc Navigator Prop

| Prop | Type | Description |
|------|------|-------------|
| `navigator` | `JoyDocNavigator` | Navigator instance for external navigation control |
